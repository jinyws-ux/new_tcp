<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>日志分析系统</title>
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/visual-parser.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script type="module" src="/static/js/app.js"></script>
    <script type="module" src="/static/js/modules/visual-parser.js"></script>
    <!--    <script defer src="/static/js/main-simple.js"></script>-->
</head>

<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-wave-square"></i>
                </div>
                <div class="logo-text">
                    <h1>日志分析系统</h1>
                    <p>智慧运维工作台</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-danger" id="btn-exit-backend" title="退出后台"><i class="fas fa-power-off"></i>
                    退出后台</button>
            </div>
        </header>

        <!-- 标签页导航 -->
        <div class="tabs">
            <div class="tab active" data-tab="download">
                <div class="tab-icon"><i class="fas fa-download"></i></div>
                <div class="tab-label">
                    <span>日志下载</span>
                    <small>下载</small>
                </div>
            </div>
            <div class="tab" data-tab="analyze">
                <div class="tab-icon"><i class="fas fa-chart-line"></i></div>
                <div class="tab-label">
                    <span>日志分析</span>
                    <small>分析</small>
                </div>
            </div>
            <div class="tab" data-tab="server-config">
                <div class="tab-icon"><i class="fas fa-server"></i></div>
                <div class="tab-label">
                    <span>服务器配置</span>
                    <small>配置</small>
                </div>
            </div>
            <div class="tab" data-tab="parser-config">
                <div class="tab-icon"><i class="fas fa-code-branch"></i></div>
                <div class="tab-label">
                    <span>解析逻辑配置</span>
                    <small>解析</small>
                </div>
            </div>
        </div>

        <!-- 日志下载标签页 -->
        <!-- 下载日志 -->
        <div id="download-tab" class="tab-content">
            <div class="message-container" id="download-messages" data-label="日志下载"></div>

            <div class="config-layout neon-grid">
                <!-- 左：搜索与结果 -->
                <section class="config-form-section neon-card">
                    <!-- 添加模板模式提示条（默认隐藏） -->
                    <div id="template-hint" class="message message-info" style="display:none; margin-bottom:12px;">
                        正在添加区域：请选择厂区与系统，并在“节点”填入多个节点（英文逗号分隔，例如：2001,2002,2003）。
                    </div>

                    <form id="download-form" class="config-form">
                        <div class="form-group">
                            <label for="factory-select">厂区</label>
                            <select id="factory-select"></select>
                        </div>
                        <div class="form-group">
                            <label for="system-select">系统</label>
                            <select id="system-select"></select>
                        </div>


                        <div class="form-group">
                            <label for="node-input">节点（支持多个，英文逗号分隔）</label>
                            <input id="node-input" type="text" placeholder="示例：2001,2002,2003">
                        </div>

                        <div class="checkbox-group">
                            <label class="checkbox-item"><input id="include-realtime" type="checkbox" checked>
                                实时</label>
                            <label class="checkbox-item"><input id="include-archive" type="checkbox"> 归档</label>
                        </div>

                        <div class="date-range" id="date-range" style="display:none;">
                            <input id="date-start" type="date" placeholder="开始日期">
                            <span>—</span>
                            <input id="date-end" type="date" placeholder="结束日期">
                        </div>

                        <!-- 操作区：默认显示 A；添加模板模式显示 B；选中模板后主按钮文案会切换 -->
                        <div id="download-actions-default" class="analyze-actions" style="margin-top:12px;">
                            <button type="button" class="btn btn-primary" id="btn-search"><i class="fas fa-search"></i>
                                搜索日志</button>
                            <button type="button" class="btn btn-secondary" id="btn-refresh"><i class="fas fa-sync"></i>
                                刷新列表</button>
                            <!--                <button type="button" class="btn" id="btn-open-dir"><i class="fas fa-folder-open"></i> 打开下载目录</button>-->
                        </div>

                        <div id="download-actions-template" class="analyze-actions"
                            style="display:none; margin-top:12px;">
                            <button type="button" class="btn btn-success" id="btn-save-template"><i
                                    class="fas fa-save"></i> 保存区域</button>
                            <button type="button" class="btn btn-danger" id="btn-cancel-template"><i
                                    class="fas fa-times"></i> 取消</button>
                        </div>

                        <!-- 选中模板提示（左侧锁定时显示） -->
                        <div id="selected-template-badge" class="status-badge status-warning"
                            style="display:none; margin-top:12px;">
                            已选模板：<span id="selected-template-name"></span>
                            <button type="button" class="btn btn-sm" id="btn-unselect-template"
                                style="margin-left:8px;">解除选择</button>
                        </div>
                    </form>

                    <!-- 结果表 -->
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th class="col-select"><input type="checkbox" id="logs-check-all" title="全选"></th>
                                    <th>文件名</th>
                                    <th>节点</th>
                                    <th>类型</th>
                                    <th>大小</th>
                                    <th>时间</th>
                                    <th>路径</th>
                                </tr>
                            </thead>
                            <tbody id="logs-search-body">
                                <tr>
                                    <td colspan="7" class="message-empty">尚无结果</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-row" style="margin-top:12px;">
                        <button id="btn-download-logs" class="btn btn-primary" disabled>
                            <i class="fas fa-download"></i> 下载选中日志
                        </button>
                        <button id="btn-download-and-analyze" class="btn btn-success" disabled>
                            <i class="fas fa-chart-line"></i> 下载并自动分析
                        </button>
                    </div>

                </section>

                <!-- 右：区域模板 -->
                <aside class="config-list-section neon-card template-panel">
                    <div class="config-list">
                        <div class="panel-heading">
                            <div>
                                <p class="panel-label">区域模板</p>
                                <h4>区域模板</h4>
                            </div>
                            <button class="btn btn-primary" id="btn-add-template"><i class="fas fa-plus"></i>
                                添加区域</button>
                        </div>

                        <div class="search-box search-box--pill">
                            <i class="fas fa-search"></i>
                            <input id="template-search-input" class="search-input" placeholder="搜索名称 / 节点">
                            <button class="btn-clear-search" id="template-clear-search" title="清空">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div id="template-list">
                            <div class="message-empty">暂无模板</div>
                        </div>

                        <div class="list-footer">
                            <button class="btn" id="btn-more-templates" style="display:none;">加载更多</button>
                        </div>
                    </div>
                </aside>
            </div>
        </div>


        <!-- 日志分析标签页 -->
        <div class="tab-content" id="analyze-tab">
            <h2><i class="fas fa-chart-bar"></i> 日志分析</h2>
            <div id="analyze-messages" class="message-container" data-label="日志分析">
                <div class="message-empty"></div>
            </div>
            <div class="analyze-controls">
                <div class="analyze-controls-left">
                    <div class="form-group config-select-group">
                        <label for="config-select">选择解析配置</label>
                        <select id="config-select" class="config-select">
                            <option value="">-- 请选择解析配置 --</option>
                        </select>
                    </div>
                </div>
                <div class="analyze-controls-right">
                    <div class="analyze-actions">
                        <button class="btn btn-refresh" id="refresh-logs-btn">
                            <i class="fas fa-sync"></i> 刷新列表
                        </button>
                        <button class="btn btn-analyze" id="analyze-logs-btn">
                            <i class="fas fa-play"></i> 开始分析
                        </button>
                        <button class="btn btn-report" id="open-reports-dir-btn">
                            <i class="fas fa-folder-open"></i> 打开报告目录
                        </button>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <h3>已下载日志</h3>
                <table>
                    <thead>
                        <tr>
                            <th><input id="select-all-logs" type="checkbox"></th>
                            <th>文件名</th>
                            <th>厂区</th>
                            <th>系统</th>
                            <th>节点</th>
                            <th>日志时间</th>
                            <th>下载时间</th>
                            <th>大小</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="logs-body"></tbody>
                </table>
                <div class="empty-state" id="no-logs-message" style="display: none;">
                    <i class="fas fa-folder-open"></i>
                    <p>暂无已下载日志</p>
                    <p>请先使用"日志下载"功能下载日志文件</p>
                </div>
            </div>

            <div class="analysis-stats-card">
                <div class="analysis-stats-card__header">
                    <h3><i class="fas fa-stopwatch"></i> 分析阶段耗时</h3>
                    <p>最近一次分析会记录各阶段用时，方便判断卡顿环节。</p>
                </div>
                <div id="analysis-stats-body" class="analysis-stats-body">
                    <div class="message-empty">尚未运行分析</div>
                </div>
            </div>
        </div>

        <!-- 服务器配置标签页 -->
        <div class="tab-content" id="server-config-tab">
            <h2><i class="fas fa-server"></i> 服务器配置管理</h2>
            <div id="server-config-messages" class="message-container" data-label="服务器配置">
                <div class="message-empty"></div>
            </div>
            <div class="config-layout">
                <div class="config-form-section neon-card">
                    <div class="config-form">
                        <h3>添加/编辑配置</h3>
                        <div class="form-group">
                            <label>厂区名称</label>
                            <select id="factory-name" class="form-control">
                                <option value="" disabled selected>-- 请选择厂区 --</option>
                                <option value="DaDong">DaDong</option>
                                <option value="TieXi">TieXi</option>
                                <option value="Lyida">Lydia</option>
                                <option value="PT">PowerTrain</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>系统名称</label>
                            <input id="system-name" placeholder="例如: OSM" type="text">
                        </div>
                        <div class="form-group">
                            <label>服务器别名</label>
                            <div class="input-with-action">
                                <input id="server-alias" placeholder="例如: apipso71" type="text">
                                <button type="button" class="btn btn-sm" id="gen-default-paths-btn" title="根据别名生成默认路径">
                                    生成默认路径
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>主机名/IP</label>
                            <input id="server-hostname" placeholder="例如: ltvshe0ipso13" type="text">
                        </div>
                        <div class="form-group">
                            <label>用户名</label>
                            <input id="server-username" placeholder="SSH用户名" type="text">
                        </div>
                        <div class="form-group">
                            <label>密码</label>
                            <div class="input-with-toggle">
                                <input id="server-password" placeholder="SSH密码" type="password">
                                <button type="button" class="password-toggle" id="toggle-password-visibility"
                                    aria-pressed="false" data-visible="false" title="显示/隐藏密码">
                                    <i class="fas fa-eye icon-eye" aria-hidden="true"></i>
                                    <i class="fas fa-eye-slash icon-eye-slash" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>日志路径配置</label>
                            <input id="server-realtime-path" placeholder="例如: /apipso71/km/log" type="text">
                        </div>
                        <div class="form-group">
                            <label>Archive日志配置</label>
                            <input id="server-archive-path"
                                placeholder="例如: /nfs/apipso71/ips_log_archive/apipso71/km_log" type="text">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-search" id="save-config-btn">
                                <i class="fas fa-save"></i> 保存配置
                            </button>
                            <button class="btn btn-secondary" id="cancel-edit-btn" style="display: none;">
                                <i class="fas fa-times"></i> 取消编辑
                            </button>
                        </div>
                    </div>
                </div>
                <div class="config-list-section neon-card">
                    <div class="config-list">
                        <div class="server-config-header">
                            <h3>现有配置</h3>
                            <p class="server-config-hint">默认折叠厂区，可点击展开或使用搜索定位系统</p>
                        </div>
                        <div class="server-config-search">
                            <i class="fas fa-search"></i>
                            <input id="server-config-search" placeholder="搜索厂区 / 系统 / 主机..." type="text">
                            <button class="btn-clear-search" id="server-config-search-clear" title="清空">&times;</button>
                        </div>
                        <div id="server-configs-container"></div>
                        <div class="empty-state" id="no-server-configs-message">
                            <i class="fas fa-cogs"></i>
                            <p>暂无服务器配置</p>
                            <p>请添加新的服务器配置</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 解析逻辑配置标签页（工具校验100%闭合） -->
        <div id="parser-config-tab" class="tab-content">
            <h2><i class="fas fa-cogs"></i> 解析逻辑配置</h2>
            <div id="parser-config-messages" class="message-container" data-label="解析配置">
                <div class="message-empty"></div>
            </div>

            <!-- 厂区系统选择 -->
            <div class="selection-panel" id="factory-system-selection">
                <div class="selection-header">
                    <h3>选择配置范围</h3>
                    <p class="selection-description">请先选择要配置的厂区和系统</p>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="parser-factory-select">选择厂区</label>
                        <select id="parser-factory-select" class="form-control">
                            <option value="">-- 请选择厂区 --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="parser-system-select">选择系统</label>
                        <select id="parser-system-select" class="form-control">
                            <option value="">-- 请选择系统 --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" id="enter-workspace-btn">
                            <i class="fas fa-play"></i> 进入配置工作台
                        </button>
                    </div>
                </div>
            </div>

            <!-- 配置工作台 -->
            <div class="simple-config-workspace" style="display: none;">
                <div class="parser-shell">
                    <!-- 顶部工具栏 -->
                    <div class="parser-shell__toolbar">
                        <div class="parser-breadcrumb">
                            <span class="breadcrumb-label">当前范围</span>
                            <strong id="current-factory-breadcrumb">未知厂区</strong>
                            <span>/</span>
                            <strong id="current-system-breadcrumb">未知系统</strong>
                        </div>
                        <div class="parser-toolbar-actions">
                            <button class="btn btn-secondary" data-action="import-config"><i class="fas fa-upload"></i>
                                导入</button>
                            <button class="btn btn-secondary" data-action="export-config"><i
                                    class="fas fa-download"></i> 导出</button>
                            <button class="btn btn-tertiary" id="exit-workspace-btn"><i class="fas fa-arrow-left"></i>
                                退出控制台</button>
                        </div>
                    </div>

                    <!-- 剪贴板状态 -->
                    <div class="parser-clipboard" id="parser-clipboard" data-state="empty">
                        <div class="parser-clipboard__icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="parser-clipboard__content">
                            <p id="clipboard-label">尚未复制任何配置</p>
                            <small id="clipboard-hint">从左侧选择项目后点击“复制”按钮</small>
                        </div>
                        <div class="parser-clipboard__actions">
                            <button class="btn btn-sm btn-ghost" data-action="clear-clipboard">
                                <i class="fas fa-times-circle"></i> 清空
                            </button>
                        </div>
                    </div>

                    <!-- 三列布局 -->
                    <div class="parser-three-column preview-collapsed">
                        <!-- 左列：导航树 -->
                        <aside class="parser-left-nav">
                            <div class="parser-nav-card">
                                <div class="parser-nav-header">
                                    <div>
                                        <p class="parser-nav-label">配置导航</p>
                                        <h4>报文类型结构</h4>
                                        <small>展开查看版本 / 字段 / 转义</small>
                                    </div>
                                    <div class="parser-nav-actions">
                                        <button class="btn btn-icon" data-action="expand-all" title="展开全部"><i
                                                class="fas fa-expand-alt"></i></button>
                                        <button class="btn btn-icon" data-action="collapse-all" title="折叠全部"><i
                                                class="fas fa-compress-alt"></i></button>
                                    </div>
                                </div>
                                <div class="parser-search-row">
                                    <div class="parser-search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="msg-type-search" placeholder="搜索报文类型 / 版本">
                                    </div>
                                    <button class="btn btn-primary btn-sm" data-action="open-add-message-type"><i
                                            class="fas fa-plus"></i> 新增类型</button>
                                    <button class="btn btn-info btn-sm" id="open-visual-parser-btn"
                                        style="margin-left: 5px;"><i class="fas fa-magic"></i> 可视化添加</button>
                                </div>
                                <div id="left-nav-tree" class="parser-nav-tree">
                                    <div class="parser-tree-placeholder">
                                        <i class="fas fa-folder-open"></i>
                                        <p>暂无报文类型，点击"新增类型"开始配置</p>
                                    </div>
                                </div>
                            </div>
                        </aside>

                        <!-- 中列：编辑面板 -->
                        <section class="parser-middle-edit">
                            <div class="parser-edit-card">
                                <div class="parser-edit-header">
                                    <div>
                                        <p class="parser-edit-label">编辑区域</p>
                                        <h4>配置编辑器</h4>
                                        <small>选中左侧任意层级后，可在此处新增、复制或粘贴</small>
                                    </div>
                                    <div class="parser-edit-actions">
                                        <button class="btn btn-ghost" id="undo-btn" onclick="undoLastOperation()"
                                            disabled><i class="fas fa-undo"></i> 撤销</button>
                                        <span id="history-count" class="history-counter">0/10</span>
                                    </div>
                                </div>
                                <div id="full-layers-container" class="parser-full-layers">
                                    <div class="parser-layers-placeholder">
                                        <i class="fas fa-mouse-pointer"></i>
                                        <p>请从左侧选择要配置的项</p>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 右列：JSON预览 -->
                        <aside class="parser-right-json is-collapsed" id="parser-preview-panel" data-state="collapsed">
                            <button type="button" class="parser-preview-toggle" id="parser-preview-toggle"
                                aria-expanded="false" title="点击展开实时预览">
                                <span class="toggle-text">点击展开实时预览</span>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="parser-preview-body">
                                <div class="parser-json-header">
                                    <div>
                                        <p class="parser-edit-label">实时预览</p>
                                        <h5>JSON 实时预览</h5>
                                        <small>每次保存或粘贴后自动刷新</small>
                                    </div>
                                    <button class="btn btn-sm btn-secondary" data-action="copy-json"><i
                                            class="fas fa-copy"></i> 复制</button>
                                </div>
                                <div id="json-preview-content" class="parser-json-preview">
                                    <div class="parser-json-placeholder">
                                        <i class="fas fa-code"></i>
                                        <p>配置变更后实时刷新</p>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>

            <!-- 添加报文类型模态框 -->
            <div id="add-message-type-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-envelope"></i> 添加报文类型</h3>
                        <button class="close-btn" onclick="hideAddMessageTypeModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-message-type-form">
                            <div class="form-group">
                                <label for="message-type-name">报文类型名称</label>
                                <input type="text" id="message-type-name" class="form-control" placeholder="请输入报文类型名称"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="message-type-description">描述</label>
                                <input type="text" id="message-type-description" class="form-control"
                                    placeholder="请输入描述信息">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="hideAddMessageTypeModal()">取消</button>
                        <button class="btn btn-primary" onclick="submitMessageTypeForm()">确认添加</button>
                    </div>
                </div>
            </div>

            <!-- 添加版本模态框 -->
            <div id="add-version-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-code-branch"></i> 添加版本</h3>
                        <button class="close-btn" onclick="hideAddVersionModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-version-form">
                            <div class="form-group">
                                <label for="version-message-type">所属报文类型</label>
                                <select id="version-message-type" class="form-control" required>
                                    <option value="">-- 请选择报文类型 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>版本号</label>
                                <input type="text" id="version-number" class="form-control"
                                    placeholder="请输入版本号（如0001、V1.0）" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="hideAddVersionModal()">取消</button>
                        <button class="btn btn-primary" onclick="submitVersionForm()">确认添加</button>
                    </div>
                </div>
            </div>

            <!-- 添加字段模态框 -->
            <div id="add-field-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-tag"></i> 添加字段</h3>
                        <button class="close-btn" onclick="hideAddFieldModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-field-form">
                            <div class="form-group">
                                <label for="field-message-type">所属报文类型</label>
                                <select id="field-message-type" class="form-control" required>
                                    <option value="">-- 请选择报文类型 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="field-version">所属版本</label>
                                <select id="field-version" class="form-control" required>
                                    <option value="">-- 请选择版本 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="field-name">字段名称</label>
                                <input type="text" id="field-name" class="form-control" placeholder="请输入字段名称" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="field-start">起始位置</label>
                                    <input type="number" id="field-start" class="form-control" value="0" min="0"
                                        required>
                                </div>
                                <div class="form-group">
                                    <label for="field-length">字段长度</label>
                                    <input type="number" id="field-length" class="form-control" placeholder="留空表示到结尾"
                                        min="1">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="hideAddFieldModal()">取消</button>
                        <button class="btn btn-primary" onclick="submitFieldForm()">确认添加</button>
                    </div>
                </div>
            </div>

            <!-- 添加转义模态框 -->
            <div id="add-escape-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-exchange-alt"></i> 添加转义</h3>
                        <button class="close-btn" onclick="hideAddEscapeModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-escape-form">
                            <div class="form-group">
                                <label for="escape-message-type">所属报文类型</label>
                                <select id="escape-message-type" class="form-control" required>
                                    <option value="">-- 请选择报文类型 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="escape-version">所属版本</label>
                                <select id="escape-version" class="form-control" required>
                                    <option value="">-- 请选择版本 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="escape-field">所属字段</label>
                                <select id="escape-field" class="form-control" required>
                                    <option value="">-- 请选择字段 --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="escape-original">原始值</label>
                                <input type="text" id="escape-original" class="form-control" placeholder="请输入原始值"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="escape-target">转义后值</label>
                                <input type="text" id="escape-target" class="form-control" placeholder="请输入转义后值"
                                    required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="hideAddEscapeModal()">取消</button>
                        <button class="btn btn-primary" id="escape-submit-btn" type="button">确认添加</button>
                    </div>
                </div>
            </div>

            <!-- 编辑配置模态框 -->
            <div id="edit-config-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="edit-modal-title">编辑配置项</h3>
                        <button class="close-btn" onclick="hideEditConfigModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <div id="edit-config-form"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="hideEditConfigModal()">取消</button>
                        <button class="btn btn-primary" onclick="submitEditForm()">保存修改</button>
                        <button class="btn btn-danger" onclick="showDeleteConfirmModal()">删除</button>
                    </div>
                </div>
            </div>

            <!-- 删除确认模态框 -->
            <div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> 删除确认</h3>
                        <button class="close-btn" onclick="hideDeleteConfirmModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <p class="text-danger">警告：此操作将删除选中项及下属所有配置，且无法恢复！</p>
                        <div class="form-group">
                            <label>请输入 <strong>DELETE</strong> 确认删除</label>
                            <input type="text" id="delete-confirm-input" class="form-control" placeholder="输入DELETE">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="hideDeleteConfirmModal()">取消</button>
                        <button class="btn btn-danger" onclick="confirmDeleteNode()">确认删除</button>
                    </div>
                </div>
            </div>

            <!-- 复制状态提示 -->
            <div id="copy-tip" class="copy-tip" style="display: none;">
                <i class="fas fa-check-circle"></i> 已复制选中层级配置
            </div>

        </div>

        <!-- 确认弹窗（置于 body 内） -->
        <div id="confirm-modal"
            style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.35); z-index: 9999;">
            <div
                style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width: 92%; max-width: 460px; padding: 18px; background: #0c0f1a; border: 1px solid #2a2f45; border-radius: 8px; box-shadow: 0 6px 24px rgba(0,0,0,0.35);">
                <h3 style="margin:0 0 8px; color:#e8eef7;">确认操作</h3>
                <p id="confirm-text" style="margin:0 0 16px; color:#aab4c3;"></p>
                <div style="display:flex; gap:10px; justify-content:flex-end;">
                    <button class="btn" id="confirm-cancel">取消</button>
                    <button class="btn btn-danger" id="confirm-ok">确定</button>
                </div>
            </div>
        </div>

        <div id="import-mode-modal"
            style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.35); z-index: 9999;">
            <div
                style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width: 92%; max-width: 480px; padding: 18px; background: #0c0f1a; border: 1px solid #2a2f45; border-radius: 8px; box-shadow: 0 6px 24px rgba(0,0,0,0.35);">
                <h3 style="margin:0 0 8px; color:#e8eef7;">选择导入模式</h3>
                <p style="margin:0 0 12px; color:#aab4c3;">请选择导入方式：全量覆盖或增量插入。</p>
                <ul style="margin:0 0 14px; padding-left:20px; color:#8f98aa;">
                    <li>全量覆盖：用导入文件完全替换当前配置</li>
                    <li>增量插入：只插入导入文件中的新增项，不覆盖已有内容</li>
                </ul>
                <div style="display:flex; gap:10px; justify-content:flex-end;">
                    <button class="btn" id="import-mode-cancel">取消</button>
                    <button class="btn btn-secondary" id="import-mode-overwrite">全量覆盖</button>
                    <button class="btn btn-success" id="import-mode-merge">增量插入</button>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <footer>
            <p>ITCC日志分析系统 &copy; 2025 | 版本 0.0.1 Beta</p>
        </footer>
    </div>
</body>

</html>